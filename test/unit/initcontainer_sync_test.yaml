---
suite: test sync init container
templates:
  - deployment-sync.yaml
tests:
  - it: empty init container
    asserts:
      - notExists:
          path: spec.template.spec.initContainers
  - it: dummy init container
    set:
      sync:
        initContainers:
          - name: hello-world
            image: dummy
            command:
              - /bin/sh
              - -c
              - echo "hello world"
            volumeMounts:
              - name: foo
                mountPath: /bar
            env:
              - name: ENV_VAR
                value: VALUE
    asserts:
      - equal:
          path: spec.template.spec.initContainers[0].name
          value: hello-world
      - equal:
          path: spec.template.spec.initContainers[0].image
          value: dummy
      - equal:
          path: spec.template.spec.initContainers[0].command
          value: [/bin/sh, -c, echo "hello world"]
      - equal:
          path: spec.template.spec.initContainers[0].volumeMounts[0].name
          value: foo
      - equal:
          path: spec.template.spec.initContainers[0].volumeMounts[0].mountPath
          value: /bar
      - equal:
          path: spec.template.spec.initContainers[0].env[0].name
          value: ENV_VAR
      - equal:
          path: spec.template.spec.initContainers[0].env[0].value
          value: VALUE